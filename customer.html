<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FarmFresh — Track Delivery</title>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://cdn.tailwindcss.com"></script>
<style>#map { height: 80vh; }</style>
</head>
<body class="bg-gray-50">
<header class="bg-green-500 text-white p-4 text-lg font-bold">FarmFresh — Track Your Order</header>

<main class="p-4 max-w-xl mx-auto">
  <input id="deliveryId" class="border p-2 w-full rounded mb-2" placeholder="Enter tracking code" />
  <button id="joinBtn" class="bg-green-500 text-white px-4 py-2 rounded mb-4">Track</button>
  <div id="map" class="rounded shadow"></div>
</main>

<script>
const socket = io("http://localhost:5000"); // backend
let driverMarker = null;
const map = L.map("map").setView([20, 78], 5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution: "&copy; OpenStreetMap" }).addTo(map);

document.getElementById('joinBtn').addEventListener('click', () => {
  const deliveryId = document.getElementById('deliveryId').value.trim();
  if (!deliveryId) { alert("Enter tracking code"); return; }
  socket.emit('customer:join', { deliveryId });
});

socket.on('location:update', (data) => {
  if (!driverMarker) {
    driverMarker = L.marker([data.lat, data.lng]).addTo(map);
    map.setView([data.lat, data.lng], 15);
  } else driverMarker.setLatLng([data.lat, data.lng]);
});
</script>
</body>
</html>
